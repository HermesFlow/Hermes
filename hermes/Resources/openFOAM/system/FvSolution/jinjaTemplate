/*--------------------------------*- C++ -*----------------------------------*\
| =========                 |                                                 |
| \\      /  F ield         | OpenFOAM: The Open Source CFD Toolbox           |
|  \\    /   O peration     | Website:  https://openfoam.org                  |
|   \\  /    A nd           | Version:   3                                    |
|    \\/     M anipulation  |                                                 |
\*---------------------------------------------------------------------------*/
FoamFile
{
    format      ascii;
    class       dictionary;
    location    "system";
    object      fvSolution;
}
// * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * * //

{%- import "openFOAM/system/FvSolution/solvers.jinja" as solvers %}

solvers
{
    {% for fieldName, solverData in fields.items() %}
        {{ solvers.solver(fieldName, solverData, False) }}
        {% if solverData.final is defined %}
            {{ solvers.solver(fieldName + "Final", solverData.final, False) }}
        {% endif %}
    {% endfor %}
}

{{solverProperties.algorithm}}
{
    {% if 'residualControl' in solverProperties %}
    residualControl
    {
        {% for fieldName, factor in solverProperties.residualControl.items() -%}
        {{fieldName}}    {{factor}};
        {% endfor %}
    }
    {% endif %}

    {% if 'solverFields' in solverProperties %}
        {% for field,fieldValue in solverProperties.solverFields.items() -%}
            {{field}} {{fieldValue}};
        {% endfor %}
    {% endif %}
}

relaxationFactors
{
    {% if 'fields' in relaxationFactors %}
    fields
    {
        {% for fieldName, factor in relaxationFactors.fields.items() -%}
        {{fieldName}} {{factor}};
        {% endfor %}
    }
    {% endif %}

    {% if 'equations' in relaxationFactors %}
    equations
    {
        {% for fieldName, factorData in relaxationFactors.equations.items() %}
            {% if factorData is mapping %}
                {% if factorData.factor is defined %}
                {{ fieldName }}    {{ factorData.factor }};
                {% endif %}
                {% if factorData.final is defined %}
                {{ fieldName }}Final    {{ factorData.final }};
                {% endif %}

                }
            {% else %}
                {{ fieldName }}    {{ factorData }};
            {% endif %}
        {% endfor %}


    }
    {% endif %}
}

// ************************************************************************* //